{% extends 'base.html' %}

{% block title %}
   My Results Insight
{% endblock %}

{% block content %}

{% if processed_semester_data %}
    <table>
        <thead>
            <tr>
                <th class="px-4 pt-4 pb-1">Semester</th>
                <th class="px-4 pt-4 pb-1">GPA</th>
                <th class="px-4 pt-4 pb-1">CGPA</th>
                <th class="px-4 pt-4 pb-1">Branch GPA</th>
                <th class="px-4 pt-4 pb-1">Units Offered</th>
            </tr>
        </thead>
        <tbody>
            {% for semester, data in processed_semester_data.items %}
            <tr>
                <td class="px-4 py-1">{{ semester }}</td>
                <td class="px-4 py-1">{{ data.GPA }}</td>
                <td class="px-4 py-1">{{ data.CGPA }}</td>
                <td class="px-4 py-2">
                    <ul>
                        {% for branch, gpa in data.Branch_GPA.items %}
                        <li>{{ branch }}: {{ gpa }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td class="px-4 py-1">{{ data.Total_units }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No GPA data available for display.</p>
{% endif %}

{% if semester_avg_scores %}
    <table class="mb-4">
        <thead>
            <tr>
                <th class="px-4 pt-4 pb-1">Semester</th>
                <th class="px-4 pt-4 pb-1">Average Score</th>
            </tr>
        </thead>
        <tbody>
            {% for semester, avg_score in semester_avg_scores.items %}
            <tr>
                <td class="px-4 py-1">{{ semester }}</td>
                <td class="px-4 py-1">{{ avg_score }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No semester average scores available.</p>
{% endif %}

{% if branch_semester_avg_scores %}
    <table>
        <thead>
            <tr>
                <th class="px-4 pt-4 pb-1">Semester</th>
                <th class="px-4 pt-4 pb-1">Branch Average Scores</th>
            </tr>
        </thead>
        <tbody>
            {% for semester, branch_scores in branch_semester_avg_scores.items %}
            <tr>
                <td class="px-4 py-1">{{ semester }}</td>
                <td class="px-4 py-2">
                    <ul>
                        {% for branch, avg_score in branch_scores.items %}
                        <li>{{ branch }}: {{ avg_score }}</li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No branch semester average scores available.</p>
{% endif %}

{% if correlations %}
    <h2 class="text-center text-2xl font-bold px-4 pt-3">Correlational Analysis</h2>
    <div class="grid grid-cols-3 gap-2 px-4 py-4">
        {% for metric_pair, correlation in correlations.items %}
        <div class="border border-gray p-4 rounded shadow">
            <p class="font-bold">{{ metric_pair.0 }} and {{ metric_pair.1 }}</p>
            <p class="text-gray-600">Correlation: {{ correlation }}</p>
        </div>
        {% endfor %}
    </div>
{% else %}
    <p class="text-center text-gray-500">No correlation analysis available.</p>
{% endif %}

{% if partials %}
    <h2 class="text-center text-2xl font-bold px-4 pt-3">Partial Correlation Analysis</h2>
    <table>
        <thead>
            <tr>
                <th class="px-4 pt-4 pb-1">Dependent Var.</th>
                <th class="px-4 pt-4 pb-1">Independent Var. </th>
                <th class="px-4 pt-4 pb-1">Observations</th>
                <th class="px-4 pt-4 pb-1">Correlation</th>
                <th class="px-4 pt-4 pb-1">Confidence Interval(95%)</th>
                <th class="px-4 pt-4 pb-1">Prob. Value</th>
            </tr>
        </thead>
        <tbody>
            {% for partial in partials %}
            <tr>
                <td class="px-4 py-1">{{ partial.y }}</td>
                <td class="px-4 py-1">{{ partial.x }}</td>
                <td class="px-4 py-1">{{ partial.n }}</td>
                <td class="px-4 py-1">{{ partial.r }}</td>
                <td class="px-4 py-1">{{ partial.ci95 }}</td>
                <td class="px-4 py-1">{{ partial.p_val }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-center text-gray-500">No partial correlation analysis available.</p>
{% endif %}

<h2 class="text-center text-2xl font-bold px-4 pt-3">Complete Results Dictionary</h2>
<div class="py-3 px-4">{{ cleaned_results }}</div>

{% endblock %}
